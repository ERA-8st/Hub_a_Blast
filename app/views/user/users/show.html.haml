.container
  .row.user-header
    .col-lg-2.col-md-2.col-xs-2
    .col-lg-8.col-md-8.col-xs-8.text-center
      = link_to user_user_path(@user) do
        %i.fa.fa-home
      = link_to user_song_favorites_path(user_id: @user.id) do
        %i.fa.fa-bookmark
      - if @user == current_user
        = link_to edit_user_user_path(@user) do
          %i.fa.fa-pencil
        = link_to user_notifications_path do
          %i.fa.fa-bell
      - unless user_signed_in? && @user.id == current_user.id 
        - if (Relationship.find_by(user_id: @user, follow_id: current_user)) && (current_user.following?(@user)) 
          - if @isRoom == true 
            = link_to user_room_path(@roomId, anchor: 'last') do
              %i.fa.fa-comments
          - else
            = form_for @room, url: user_rooms_path do |f|
              = fields_for @entry do |e|
                = e.hidden_field :user_id, value: @user.id 
              = button_tag type: 'submit' do
                %i.fa.fa-comments
    .col-lg-2.col-md-2.col-xs-2
      - unless @user == current_user
        -# フォローボタン
        %div{class: "follow_button#{@user.id} header-follow-button", style: "display:inline-block;"}
          = render "user/relationships/follow_button", user: @user
  .row
    .col-lg-3.col-md-3.col-xs-3
      = attachment_image_tag(@user, :profile_image,  size: "200x200", fallback: "no-image.png")
    .col-lg-3.col-md-3.col-xs-3
      = @user.user_name
      %br= @user.introduction
      = link_to "フォロー", user_users_follow_index_path(@user)
      %br
      = link_to "フォロワー", user_users_follower_index_path(@user)
      -# DM機能
      - unless user_signed_in? && @user.id == current_user.id 
        - if (Relationship.find_by(user_id: @user, follow_id: current_user)) && (current_user.following?(@user)) 
          - if @isRoom == true 
            %p.user-show-room
              = link_to "チャットへ", user_room_path(@roomId, anchor: 'last'), class: "btn btn-primary"
                
          - else
            = form_for @room, url: user_rooms_path do |f|
              = fields_for @entry do |e|
                = e.hidden_field :user_id, value: @user.id 
              = f.submit "チャットを始める", class:"btn btn-primary user-show-chat"
    .col-lg-6.col-md-6.col-xs-6
      -# 直近でDMを送ったユーザー一覧
      - if @user == current_user
        %h2 Latest Chats
        %table.table
          - @messages.each do |message|
            %tr
              - room = Room.find(message.room_id)
              - entry = Entry.where(room_id: room.id).where.not(user_id: current_user.id)
              - @chat_user = User.find(entry.first.user_id)
              %td
                = link_to user_user_path(@chat_user) do
                  = attachment_image_tag(@chat_user, :profile_image,  size: "25x25", fallback: "no-image.png")
              %td
                = @chat_user.user_name
              %td
                = link_to user_room_path(room.id, anchor: 'last') do
                  %i.fa.fa-comments-o
  .row
    .col-lg-6.col-md-6.col-xs-6
      -# 直近でコメントした曲一覧
      - if user_signed_in? && @user == current_user
        %h2 Latest your comment
      - else
        %h2 Latest #{@user.user_name}'s comment
      - @song_comments.each do |song_comment|
        %table.table
          %tr
            %td
              = link_to user_spotify_song_show_path(song_comment.song_id) do
                - @song = RSpotify::Track.find(song_comment.song_id)
                - if @song.album.images.any?
                  - image = @song.album.images[2]
                  = image_tag(image["url"])
                - else
                  = image_tag("default.jpg")
            %td
              = @song.name
    .col-lg-6.col-md-6.col-xs-6
      -# お気に入り(ブックマーク)曲一覧
      - if user_signed_in? && @user == current_user
        %h2.favorite your favorite
      - else
        %h2.favorite #{@user.user_name}'s favorite
      = link_to "View All", user_song_favorites_path(user_id: @user.id),class: "viewall"
      - @song_favorites.each do |song_favorite|
        %table.table
          %tr
            %td
              = link_to user_spotify_song_show_path(song_favorite.song_id) do
                - @song = RSpotify::Track.find(song_favorite.song_id)
                - if @song.album.images.any?
                  - image = @song.album.images[2]
                  = image_tag(image["url"])
                - else
                  = image_tag("default.jpg")
            %td
              = @song.name